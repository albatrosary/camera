var video=document.querySelector("video"),canvas=document.querySelector("canvas"),ctx=canvas.getContext("2d"),localMediaStream=null,i=0,hasGetUserMedia=function(){return!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)},onFailSoHard=function(a){console.log("エラー!",a)},snapshot=function(){if(localMediaStream){ctx.drawImage(video,0,0);var a=document.querySelectorAll("img");a[i].src=canvas.toDataURL("image/webp"),sessionStorage.setItem(i,canvas.toDataURL("image/webp"));var b=document.querySelector("#img"),c=document.createElement("img");b.appendChild(c),i+=1}};hasGetUserMedia()?console.log("カメラ OK"):alert("未対応ブラウザです。"),window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia({video:!0},function(a){video.src=window.URL.createObjectURL(a),localMediaStream=a},onFailSoHard),$("#capture").click(function(){snapshot()}),$("#stop").click(function(){localMediaStream.stop()}),$("video").click(function(){snapshot()});